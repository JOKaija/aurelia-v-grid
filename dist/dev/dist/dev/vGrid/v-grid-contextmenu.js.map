{"version":3,"sources":["vGrid/v-grid-contextmenu.js"],"names":["Contextmenu","element","vGrid","contextMenuClassName","contextMenuItemClassName","contextMenuLinkClassName","contextMenuSplitClassName","taskItemInContext","clickCoords","clickCoordsX","clickCoordsY","menuState","menuWidth","menuHeight","menuPosition","menuPositionX","menuPositionY","windowWidth","windowHeight","getLang","value","vGridConfig","attLanguage","bind","bindingContext","overrideContext","attached","classList","contains","classToOpenOn","add","addListener","detached","removeListener","canOpen","closeIfOpen","toggleMenuOff","contextListenerBinded","contextListener","closeIfOpenBinded","addEventListener","removeEventListener","e","event","CustomEvent","detail","bubbles","dispatchEvent","clickInsideElement","preventDefault","toggleMenuOn","positionMenu","addMenuClickListner","clickListenerBinded","clickListener","document","removeMenuClickListner","clickeElIsLink","menuItemListener","button","which","className","el","srcElement","target","parentNode","createMenu","menu","createElement","innerHTML","menuHtmlMain","body","appendChild","menuItems","querySelectorAll","replaceMenu","html","removeMenu","removeChild","getPosition","x","y","offsetWidth","offsetHeight","window","innerWidth","innerHeight","style","left","top","posx","posy","pageX","pageY","clientX","clientY","scrollLeft","documentElement","scrollTop","createMenuHTML","menuArray","tempHtml","forEach","row","li","a","isHeader","setAttribute","action"],"mappings":"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","file":"vGrid/v-grid-contextmenu.js","sourceRoot":"/source/","sourcesContent":["/*****************************************************************************************************************\r\n *    Contextmenu\r\n *    Main class for attributes \"context menu\"\r\n *    Created by vegar ringdal\r\n *\r\n ****************************************************************************************************************/\r\n\r\nexport class Contextmenu {\r\n\r\n  constructor(element, vGrid) {\r\n    this.element = element;\r\n    this.vGrid = vGrid;\r\n\r\n    //main classes, should I just add these to the v-grid-config?\r\n    this.contextMenuClassName = \"v-grid-context-menu\";\r\n    this.contextMenuItemClassName = \"v-grid-context-menu__item\";\r\n    this.contextMenuLinkClassName = \"v-grid-context-menu__link\";\r\n    this.contextMenuSplitClassName = \"v-grid-context-menu__split\";\r\n\r\n\r\n    this.taskItemInContext = null;\r\n\r\n    this.clickCoords = null;\r\n    this.clickCoordsX = null;\r\n    this.clickCoordsY = null;\r\n\r\n\r\n    this.menuState = 0;\r\n    this.menuWidth = null;\r\n    this.menuHeight = null;\r\n    this.menuPosition = null;\r\n    this.menuPositionX = null;\r\n    this.menuPositionY = null;\r\n\r\n    this.windowWidth = null;\r\n    this.windowHeight = null;\r\n\r\n\r\n  }\r\n\r\n\r\n  getLang(value) {\r\n    return this.vGrid.vGridConfig.attLanguage[value];\r\n  }\r\n\r\n\r\n  bind(bindingContext, overrideContext) {\r\n    this.bindingContext = bindingContext;\r\n    this.overrideContext = overrideContext;\r\n  }\r\n\r\n\r\n  attached() {\r\n    this.element.classList.contains(this.classToOpenOn) ? null : this.element.classList.add(this.classToOpenOn);\r\n    this.addListener();\r\n  }\r\n\r\n\r\n  detached() {\r\n    this.removeListener();\r\n  }\r\n\r\n\r\n  canOpen() {\r\n    return true;\r\n  }\r\n\r\n\r\n  closeIfOpen() {\r\n    if (this.menuState) {\r\n      this.toggleMenuOff();\r\n    }\r\n  }\r\n\r\n\r\n  addListener() {\r\n    this.contextListenerBinded = this.contextListener.bind(this);\r\n    this.closeIfOpenBinded = this.closeIfOpen.bind(this);\r\n    this.element.addEventListener(\"contextmenu\", this.contextListenerBinded);\r\n    this.vGrid.element.addEventListener(\"vGridCloseContextMenuIfOpen\", this.closeIfOpenBinded);\r\n  }\r\n\r\n\r\n  removeListener() {\r\n    this.element.removeEventListener(\"contextmenu\", this.contextListenerBinded);\r\n    this.element.removeEventListener(\"vGridCloseContextMenuIfOpen\", this.closeIfOpenBinded);\r\n\r\n  }\r\n\r\n\r\n  contextListener(e) {\r\n\r\n    //close if menus if they are open when opening a new one\r\n    let event = new CustomEvent(\"vGridCloseContextMenuIfOpen\", {\r\n      detail: \"\",\r\n      bubbles: true\r\n    });\r\n    this.vGrid.element.dispatchEvent(event);\r\n\r\n\r\n    if (this.canOpen(e)) {\r\n\r\n      this.taskItemInContext = this.clickInsideElement(e, this.classToOpenOn);\r\n\r\n      if (this.taskItemInContext) {\r\n        e.preventDefault();\r\n        this.toggleMenuOn();\r\n        this.positionMenu(e);\r\n      } else {\r\n        this.taskItemInContext = null;\r\n        this.toggleMenuOff();\r\n      }\r\n\r\n    } else {\r\n      this.toggleMenuOff();\r\n    }\r\n  }\r\n\r\n\r\n  addMenuClickListner() {\r\n    this.clickListenerBinded = this.clickListener.bind(this);\r\n    document.addEventListener(\"click\", this.clickListenerBinded);\r\n  }\r\n\r\n\r\n  removeMenuClickListner() {\r\n    document.removeEventListener(\"click\", this.clickListenerBinded);\r\n  }\r\n\r\n\r\n  clickListener(e) {\r\n    var clickeElIsLink = this.clickInsideElement(e, this.contextMenuLinkClassName);\r\n\r\n    if (clickeElIsLink && this.taskItemInContext) {\r\n      e.preventDefault();\r\n      this.menuItemListener(clickeElIsLink);\r\n    } else {\r\n      var button = e.which || e.button;\r\n      if (button === 1) {\r\n        this.toggleMenuOff();\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n\r\n  clickInsideElement(e, className) {\r\n    var el = e.srcElement || e.target;\r\n\r\n    if (el.classList.contains(className)) {\r\n      return el;\r\n    } else {\r\n      while (el === el.parentNode) {\r\n        if (el.classList && el.classList.contains(className)) {\r\n          return el;\r\n        }\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n\r\n  createMenu() {\r\n    this.menu = document.createElement(\"nav\");\r\n    this.menu.classList.add(this.contextMenuClassName);\r\n    this.menu.innerHTML = this.menuHtmlMain();\r\n    document.body.appendChild(this.menu);\r\n    this.menuItems = this.menu.querySelectorAll(\".\" + this.contextMenuItemClassName);\r\n  }\r\n\r\n\r\n  replaceMenu(html) {\r\n    this.menu.innerHTML = html;\r\n    this.menuItems = this.menu.querySelectorAll(\".\" + this.contextMenuItemClassName);\r\n  }\r\n\r\n\r\n  removeMenu() {\r\n    document.body.removeChild(this.menu);\r\n    this.menu = null;\r\n    this.menuItems = null;\r\n  }\r\n\r\n\r\n  toggleMenuOn() {\r\n    if (this.menuState !== 1) {\r\n      this.menuState = 1;\r\n      this.createMenu();\r\n      this.addMenuClickListner();\r\n    }\r\n  }\r\n\r\n\r\n  toggleMenuOff() {\r\n    if (this.menuState !== 0) {\r\n      this.menuState = 0;\r\n      this.removeMenuClickListner();\r\n      this.removeMenu();\r\n\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Positions the menu properly.\r\n   */\r\n  positionMenu(e) {\r\n    this.clickCoords = this.getPosition(e);\r\n    this.clickCoordsX = this.clickCoords.x;\r\n    this.clickCoordsY = this.clickCoords.y;\r\n\r\n    this.menuWidth = this.menu.offsetWidth + 4;\r\n    this.menuHeight = this.menu.offsetHeight + 4;\r\n\r\n    this.windowWidth = window.innerWidth;\r\n    this.windowHeight = window.innerHeight;\r\n\r\n    if ((this.windowWidth - this.clickCoordsX) < this.menuWidth) {\r\n      this.menu.style.left = this.windowWidth - this.menuWidth + \"px\";\r\n    } else {\r\n      this.menu.style.left = this.clickCoordsX + \"px\";\r\n    }\r\n\r\n    if ((this.windowHeight - this.clickCoordsY) < this.menuHeight) {\r\n      this.menu.style.top = this.windowHeight - this.menuHeight + \"px\";\r\n    } else {\r\n      this.menu.style.top = this.clickCoordsY + \"px\";\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Get's exact position of event.\r\n   */\r\n  getPosition(e) {\r\n    var posx = 0;\r\n    var posy = 0;\r\n\r\n    if (!e) var e = window.event;\r\n\r\n    if (e.pageX || e.pageY) {\r\n      posx = e.pageX;\r\n      posy = e.pageY;\r\n    } else if (e.clientX || e.clientY) {\r\n      posx = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;\r\n      posy = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;\r\n    }\r\n\r\n    return {\r\n      x: posx,\r\n      y: posy\r\n    }\r\n  }\r\n\r\n\r\n  createMenuHTML(menuArray) {\r\n\r\n    var tempHtml = document.createElement(\"ul\");\r\n\r\n    menuArray.forEach((row)=> {\r\n      let li = document.createElement(\"li\");\r\n      li.classList.add(this.contextMenuItemClassName);\r\n      let a = document.createElement(\"a\");\r\n      if (row.isHeader) {\r\n        a.classList.add(this.contextMenuSplitClassName)\r\n      } else {\r\n        a.classList.add(this.contextMenuLinkClassName)\r\n      }\r\n      a.setAttribute(\"data-action\", row.action);\r\n      a.innerHTML = row.value;\r\n      tempHtml.appendChild(a);\r\n    });\r\n\r\n    return tempHtml.innerHTML;\r\n\r\n  }\r\n\r\n\r\n}\r\n"]}