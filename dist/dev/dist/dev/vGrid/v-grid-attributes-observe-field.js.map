{"version":3,"sources":["vGrid/v-grid-attributes-observe-field.js"],"names":[],"mappings":";;;;;;;;;;;;;;;AAKQ,Y,qBAAA,M;AAAQ,qB,qBAAA,e;AAAiB,mB,qBAAA,a;;AACzB,W,UAAA,K;;;6CAKK,2B,WAFZ,gBAAgB,iBAAhB,C,UACA,OAAO,OAAP,EAAgB,KAAhB,EAAuB,aAAvB,C;AAIC,6CAAY,OAAZ,EAAqB,KAArB,EAA4B,aAA5B,EAA2C;AAAA;;AACzC,eAAK,KAAL,GAAa,KAAb;AACA,eAAK,OAAL,GAAe,OAAf;AACA,eAAK,KAAL,GAAa,IAAb;AACA,eAAK,aAAL,GAAqB,aAArB;AACD;;8CAGD,I,iBAAK,c,EAAgB,e,EAAiB;AAAA;;AACpC,eAAK,cAAL,GAAsB,cAAtB;AACA,eAAK,eAAL,GAAuB,eAAvB;;AAEA,cAAG,KAAK,gBAAR,EAAyB;AACvB,iBAAK,gBAAL,CAAsB,OAAtB;AACA,iBAAK,gBAAL,GAAwB,IAAxB;AACD;;AAED,cAAI,YAAY,KAAK,KAArB;;AAGA,cAAI,aAAa,KAAK,cAAL,CAAoB,MAArC,EAA6C;AAG3C,iBAAK,KAAL,CAAW,gBAAX,CAA4B,4BAA5B;;AAGA,gBAAI,sBAAsB,KAAK,KAAL,CAAW,WAAX,CAAuB,mBAAjD;AACA,gBAAI,aAAY,KAAK,KAArB;;AAEA,gBAAI,oBAAoB,OAApB,CAA4B,UAA5B,MAA2C,CAAC,CAA5C,IAAiD,UAArD,EAAgE;AAC9D,kCAAoB,IAApB,CAAyB,UAAzB;AACD;;AAED,iBAAK,KAAL,CAAW,gBAAX,CAA4B,2BAA5B;;AAIA,iBAAK,gBAAL,GAAwB,KAAK,aAAL,CAAmB,gBAAnB,CAAoC,KAAK,cAAL,CAAoB,MAAxD,EAAgE,KAAK,KAArE,EAA4E,SAA5E,CAAsF,UAAC,QAAD,EAAW,QAAX,EAAwB;AAGpI,kBAAI,gBAAiB,aAAa,SAAb,IAA0B,aAAa,IAAxC,GAAgD,SAAS,QAAT,EAAhD,GAAsE,QAA1F;AACA,kBAAI,gBAAiB,aAAa,SAAb,IAA0B,aAAa,IAAxC,GAAgD,SAAS,QAAT,EAAhD,GAAsE,QAA1F;;AAEA,kBAAI,kBAAkB,aAAlB,IAAmC,MAAK,KAAL,CAAW,qBAAlD,EAAyE;AACvE,sBAAK,KAAL,CAAW,kBAAX,CAA8B,MAAK,KAAnC,IAA4C,QAA5C;AACD;AACF,aATuB,CAAxB;AAUD;AAEF,S;;8CAED,M,qBAAS;AACP,cAAG,KAAK,gBAAR,EAAyB;AACvB,iBAAK,gBAAL,CAAsB,OAAtB;AACA,iBAAK,gBAAL,GAAwB,IAAxB;AACD;AAEF,S","file":"vGrid/v-grid-attributes-observe-field.js","sourceRoot":"/source/","sourcesContent":["/*****************************************************************************************************************\r\n *    Just to have instant update on row events over to current entity\r\n *    Created by vegar ringdal\r\n *\r\n ****************************************************************************************************************/\r\nimport {inject, customAttribute, BindingEngine} from 'aurelia-framework';\r\nimport {VGrid} from './v-grid';\r\n\r\n\r\n@customAttribute('v-observe-field')\r\n@inject(Element, VGrid, BindingEngine)\r\nexport class vGridAttributesObserveField {\r\n\r\n\r\n  constructor(element, vGrid, bindingEngine) {\r\n    this.vGrid = vGrid;\r\n    this.element = element;\r\n    this.timer = null;\r\n    this.bindingEngine = bindingEngine;\r\n  }\r\n\r\n\r\n  bind(bindingContext, overrideContext) {\r\n    this.bindingContext = bindingContext;\r\n    this.overrideContext = overrideContext;\r\n\r\n    if(this.propertyObserver){\r\n      this.propertyObserver.dispose();\r\n      this.propertyObserver = null;\r\n    }\r\n\r\n    let attribute = this.value;\r\n\r\n    //if there is any value and rowRef\r\n    if (attribute && this.bindingContext.rowRef) {\r\n\r\n      //remove old binding to current entity\r\n      this.vGrid.vGridObservables.disableObservablesAttributes();\r\n\r\n      //add to our observer array\r\n      var attAttributeObserve = this.vGrid.vGridConfig.attAttributeObserve;\r\n      let attribute = this.value;\r\n      //if not allready added, then lets add them\r\n      if (attAttributeObserve.indexOf(attribute) === -1 && attribute) {\r\n        attAttributeObserve.push(attribute);\r\n      }\r\n      //enable observer\r\n      this.vGrid.vGridObservables.enableObservablesAttributes();\r\n\r\n\r\n      //observe property on rowref\r\n      this.propertyObserver = this.bindingEngine.propertyObserver(this.bindingContext.rowRef, this.value).subscribe((newValue, oldValue) => {\r\n\r\n        //should I do the value formatting on the currentEntity also?\r\n        var newValueCheck = (newValue !== undefined && newValue !== null) ? newValue.toString() : newValue;\r\n        var oldValueCheck = (oldValue !== undefined && oldValue !== null) ? oldValue.toString() : oldValue;\r\n\r\n        if (newValueCheck !== oldValueCheck && this.vGrid.vGridCurrentEntityRef) {\r\n          this.vGrid.vGridCurrentEntity[this.value] = newValue;\r\n        }\r\n      });\r\n    }\r\n\r\n  }\r\n\r\n  unbind() {\r\n    if(this.propertyObserver){\r\n      this.propertyObserver.dispose();\r\n      this.propertyObserver = null;\r\n    }\r\n\r\n  }\r\n\r\n\r\n}\r\n"]}