{"version":3,"sources":["vGrid/v-grid-attributes-dragDropCol.js"],"names":[],"mappings":"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","file":"vGrid/v-grid-attributes-dragDropCol.js","sourceRoot":"/source/","sourcesContent":["/*****************************************************************************************************************\r\n *    Drag drop columns for the grid\r\n *    can not be used with row-repeat... yet\r\n *    Created by vegar ringdal\r\n *\r\n ****************************************************************************************************************/\r\nimport {inject, customAttribute} from 'aurelia-framework';\r\nimport {VGrid} from './v-grid';\r\n\r\n\r\n@customAttribute('v-drag-drop-col')\r\n@inject(Element, VGrid)\r\nexport class vGridDragDropCol {\r\n\r\n\r\n  constructor(element, vGrid) {\r\n    this.vGrid = vGrid;\r\n    this.element = element;\r\n    this.dragEl;\r\n    this.canMove = false;\r\n    this.sortable = false;\r\n    this.onDragOverX = this.onDragOver.bind(this);\r\n    this.onDragEndX = this.onDragEnd.bind(this);\r\n  }\r\n\r\n\r\n  bind(bindingContext, overrideContext) {\r\n    this.bindingContext = bindingContext;\r\n    this.overrideContext = overrideContext;\r\n\r\n  }\r\n\r\n  attached() {\r\n    this.setDragHandles();\r\n\r\n    //need to be better, will change when I rebuild header into custom element\r\n    this.rootEl = this.vGrid.vGridGenerator.headerScrollElement; //this is BAD!\r\n\r\n    //add event listeners for draggable\r\n    this.mainCol.addEventListener('dragstart', this.onDragStart.bind(this), false);\r\n\r\n\r\n    //event listener for when starting to drag\r\n    this.vGrid.element.addEventListener(\"vGridDragStart\", ()=> {\r\n      this.drophelper.style[\"z-index\"] = \"100\";\r\n    });\r\n\r\n\r\n    //event listener when stopped dragging\r\n    this.vGrid.element.addEventListener(\"vGridDragStop\", ()=> {\r\n      this.drophelper.style[\"z-index\"] = \"-100\";\r\n    });\r\n\r\n\r\n  }\r\n\r\n\r\n  /***************************************************\r\n   * sets drag handle\r\n   *****************************************************/\r\n  setDragHandles() {\r\n\r\n    //add drag class\r\n    this.element.classList.add(\"vGrid-vGridDragHandle\");\r\n\r\n\r\n    //get column element\r\n    let mainCol = this.element;\r\n    while (mainCol.nodeName !== 'V-GRID-HEADER-COL') {\r\n      mainCol = mainCol.parentNode;\r\n    }\r\n    this.mainCol = mainCol;\r\n\r\n\r\n    //create drop helper (so we dont get switching on wide columns)\r\n    var drophelper = document.createElement(\"v-grid-drop\");\r\n    drophelper.style.width = \"30px\";\r\n    drophelper.style.bottom = 0;\r\n    drophelper.style.top = 0;\r\n    drophelper.style.left = parseInt(this.mainCol.clientWidth / 2) - 15 + \"px\";\r\n    //drophelper.style[\"background-color\"] = \"blue\"; //enable to see them\r\n    drophelper.style[\"z-index\"] = \"-100\";\r\n    drophelper.style.position = \"absolute\";\r\n    this.mainCol.appendChild(drophelper);\r\n    this.drophelper = drophelper;\r\n\r\n\r\n    //helpers\r\n    this.element.onmouseenter = () => {\r\n      this.canMove = true;\r\n      //add draggable to elements\r\n      this.setDraggable(true);\r\n    };\r\n\r\n\r\n    //helpers\r\n    this.element.onmouseleave = () => {\r\n      this.canMove = false;\r\n      //remove draggable to elements\r\n      this.setDraggable(false);\r\n    };\r\n\r\n\r\n  }\r\n\r\n\r\n  /***************************************************\r\n   * sets the elements draggable attribute\r\n   *****************************************************/\r\n  setDraggable(newStatus) {\r\n    this.mainCol.draggable = newStatus;\r\n  }\r\n\r\n\r\n  /***************************************************\r\n   * updates columns\r\n   *****************************************************/\r\n  updateColumns() {\r\n\r\n    //temp arrays\r\n    let tempArr = [];\r\n    let vGridConfig = [];\r\n\r\n\r\n    //loop em and build temp arrays and set new column number\r\n    var dragHandles = this.vGrid.vGridGenerator.gridElement.getElementsByTagName('v-grid-header-col');\r\n    [].slice.call(dragHandles).forEach((itemEl, index) => {\r\n      tempArr.push(parseInt(itemEl.getAttribute(\"column-no\")));\r\n      vGridConfig.push(null);\r\n      itemEl.setAttribute(\"column-no\", index);\r\n    });\r\n\r\n\r\n    //reorder to new column no\r\n    tempArr.forEach((oldI, newI) => {\r\n      vGridConfig[newI] = this.vGrid.vGridConfig.colConfig[oldI];\r\n    });\r\n\r\n\r\n    //set new columnconfig\r\n    this.vGrid.vGridConfig.colConfig = vGridConfig;\r\n\r\n\r\n    //reset template and fill data\r\n    this.vGrid.vGridGenerator.rowTemplate = null;\r\n\r\n\r\n    //rebuild the columns\r\n    this.vGrid.vGridGenerator.rebuildColumnsRows();\r\n\r\n\r\n  }\r\n\r\n\r\n  /***************************************************\r\n   * when starting dragging\r\n   *****************************************************/\r\n  onDragStart(evt) {\r\n\r\n    if (this.canMove) {\r\n\r\n      //get target\r\n      this.dragEl = evt.target;\r\n\r\n      //get our column no\r\n      this.colNo = parseInt(this.dragEl.getAttribute(\"column-no\"));\r\n\r\n      //dispatch event so all make  dropzone\r\n      let event = new CustomEvent(\"vGridDragStart\", {\r\n        detail: \"\",\r\n        bubbles: true\r\n      });\r\n      this.vGrid.element.dispatchEvent(event);\r\n\r\n\r\n      this.sortable = true;\r\n\r\n\r\n      evt.dataTransfer.effectAllowed = 'move';\r\n      evt.dataTransfer.setData('Text', '');\r\n\r\n      this.rootEl.addEventListener('dragover', this.onDragOverX, false);\r\n      this.rootEl.addEventListener('dragend', this.onDragEndX, false);\r\n\r\n      setTimeout(()=> {\r\n        this.dragEl.classList.add('ghost');\r\n      }, 0);\r\n    } else {\r\n      evt.preventDefault();\r\n    }\r\n\r\n  }\r\n\r\n\r\n  /***************************************************\r\n   * when dragging over event(moving)\r\n   *****************************************************/\r\n  onDragOver(evt) {\r\n\r\n    //why?\r\n    if (evt.preventDefault !== void 0) {\r\n      evt.preventDefault();\r\n      evt.stopPropagation();\r\n    }\r\n\r\n    //set temp col\r\n    let colNo = -1;\r\n\r\n    //get column\r\n    let target = evt.target;\r\n    if (target) {\r\n      while (target.nodeName !== 'V-GRID-HEADER-COL') {\r\n        target = target.offsetParent;\r\n      }\r\n\r\n      colNo = parseInt(target.getAttribute(\"column-no\"));\r\n      var targetNode = evt.target.nodeName === 'V-GRID-DROP';\r\n\r\n\r\n      if (colNo !== this.colNo && targetNode && colNo > -1) {\r\n        var after = colNo + 1 !== this.colNo;// && !isLong || halfway && isLong;\r\n\r\n        //reset colNo\r\n        this.colNo = colNo;\r\n\r\n        //move\r\n        this.rootEl.insertBefore(this.dragEl, after ? target.nextElementSibling : target);\r\n\r\n        //update columns\r\n        this.updateColumns();\r\n\r\n\r\n      }\r\n    }\r\n\r\n\r\n  }\r\n\r\n\r\n  /***************************************************\r\n   * when drag event have ended\r\n   *****************************************************/\r\n  onDragEnd(evt) {\r\n\r\n    evt.preventDefault();\r\n\r\n    //trigger dragdrop so all updates and remove ghost/events\r\n    let event = new CustomEvent(\"vGridDragStop\", {\r\n      detail: \"\",\r\n      bubbles: true\r\n    });\r\n    this.vGrid.element.dispatchEvent(event);\r\n\r\n    this.dragEl.classList.remove('ghost');\r\n    this.rootEl.removeEventListener('dragover', this.onDragOverX, false);\r\n    this.rootEl.removeEventListener('dragend', this.onDragEndX, false);\r\n    this.sortable = false;\r\n  }\r\n\r\n\r\n}\r\n"]}